{"ast":null,"code":"const BASE_URL = 'http://127.0.0.1:8000';\nexport const authFetch = async (url, options = {}) => {\n  const access = localStorage.getItem('access');\n  const refresh = localStorage.getItem('refresh');\n  const isFormData = options.body instanceof FormData;\n  const headers = {\n    ...(isFormData ? {} : {\n      'Content-Type': 'application/json'\n    }),\n    Authorization: `Bearer ${access}`,\n    ...options.headers\n  };\n  const fullUrl = url.startsWith('http') ? url : BASE_URL + url;\n  let response = await fetch(fullUrl, {\n    ...options,\n    headers\n  });\n\n  // Обновление access токена по refresh при 401\n  if (response.status === 401 && refresh) {\n    const refreshResponse = await fetch(BASE_URL + '/api/auth/refresh/', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        refresh\n      })\n    });\n    if (refreshResponse.ok) {\n      const data = await refreshResponse.json();\n      localStorage.setItem('access', data.access);\n      const retryHeaders = {\n        ...(isFormData ? {} : {\n          'Content-Type': 'application/json'\n        }),\n        Authorization: `Bearer ${data.access}`,\n        ...options.headers\n      };\n      response = await fetch(fullUrl, {\n        ...options,\n        headers: retryHeaders\n      });\n    } else {\n      localStorage.removeItem('access');\n      localStorage.removeItem('refresh');\n      window.location.href = '/login';\n    }\n  }\n  return response;\n};","map":{"version":3,"names":["BASE_URL","authFetch","url","options","access","localStorage","getItem","refresh","isFormData","body","FormData","headers","Authorization","fullUrl","startsWith","response","fetch","status","refreshResponse","method","JSON","stringify","ok","data","json","setItem","retryHeaders","removeItem","window","location","href"],"sources":["/app/src/utils/authFetch.js"],"sourcesContent":["const BASE_URL = 'http://127.0.0.1:8000';\r\n\r\nexport const authFetch = async (url, options = {}) => {\r\n  const access = localStorage.getItem('access');\r\n  const refresh = localStorage.getItem('refresh');\r\n\r\n  const isFormData = options.body instanceof FormData;\r\n\r\n  const headers = {\r\n    ...(isFormData ? {} : { 'Content-Type': 'application/json' }),\r\n    Authorization: `Bearer ${access}`,\r\n    ...options.headers,\r\n  };\r\n\r\n  const fullUrl = url.startsWith('http') ? url : BASE_URL + url;\r\n\r\n  let response = await fetch(fullUrl, {\r\n    ...options,\r\n    headers,\r\n  });\r\n\r\n  // Обновление access токена по refresh при 401\r\n  if (response.status === 401 && refresh) {\r\n    const refreshResponse = await fetch(BASE_URL + '/api/auth/refresh/', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ refresh }),\r\n    });\r\n\r\n    if (refreshResponse.ok) {\r\n      const data = await refreshResponse.json();\r\n      localStorage.setItem('access', data.access);\r\n\r\n      const retryHeaders = {\r\n        ...(isFormData ? {} : { 'Content-Type': 'application/json' }),\r\n        Authorization: `Bearer ${data.access}`,\r\n        ...options.headers,\r\n      };\r\n\r\n      response = await fetch(fullUrl, {\r\n        ...options,\r\n        headers: retryHeaders,\r\n      });\r\n    } else {\r\n      localStorage.removeItem('access');\r\n      localStorage.removeItem('refresh');\r\n      window.location.href = '/login';\r\n    }\r\n  }\r\n\r\n  return response;\r\n};\r\n\r\n"],"mappings":"AAAA,MAAMA,QAAQ,GAAG,uBAAuB;AAExC,OAAO,MAAMC,SAAS,GAAG,MAAAA,CAAOC,GAAG,EAAEC,OAAO,GAAG,CAAC,CAAC,KAAK;EACpD,MAAMC,MAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;EAC7C,MAAMC,OAAO,GAAGF,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC;EAE/C,MAAME,UAAU,GAAGL,OAAO,CAACM,IAAI,YAAYC,QAAQ;EAEnD,MAAMC,OAAO,GAAG;IACd,IAAIH,UAAU,GAAG,CAAC,CAAC,GAAG;MAAE,cAAc,EAAE;IAAmB,CAAC,CAAC;IAC7DI,aAAa,EAAE,UAAUR,MAAM,EAAE;IACjC,GAAGD,OAAO,CAACQ;EACb,CAAC;EAED,MAAME,OAAO,GAAGX,GAAG,CAACY,UAAU,CAAC,MAAM,CAAC,GAAGZ,GAAG,GAAGF,QAAQ,GAAGE,GAAG;EAE7D,IAAIa,QAAQ,GAAG,MAAMC,KAAK,CAACH,OAAO,EAAE;IAClC,GAAGV,OAAO;IACVQ;EACF,CAAC,CAAC;;EAEF;EACA,IAAII,QAAQ,CAACE,MAAM,KAAK,GAAG,IAAIV,OAAO,EAAE;IACtC,MAAMW,eAAe,GAAG,MAAMF,KAAK,CAAChB,QAAQ,GAAG,oBAAoB,EAAE;MACnEmB,MAAM,EAAE,MAAM;MACdR,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB,CAAC;MAC/CF,IAAI,EAAEW,IAAI,CAACC,SAAS,CAAC;QAAEd;MAAQ,CAAC;IAClC,CAAC,CAAC;IAEF,IAAIW,eAAe,CAACI,EAAE,EAAE;MACtB,MAAMC,IAAI,GAAG,MAAML,eAAe,CAACM,IAAI,CAAC,CAAC;MACzCnB,YAAY,CAACoB,OAAO,CAAC,QAAQ,EAAEF,IAAI,CAACnB,MAAM,CAAC;MAE3C,MAAMsB,YAAY,GAAG;QACnB,IAAIlB,UAAU,GAAG,CAAC,CAAC,GAAG;UAAE,cAAc,EAAE;QAAmB,CAAC,CAAC;QAC7DI,aAAa,EAAE,UAAUW,IAAI,CAACnB,MAAM,EAAE;QACtC,GAAGD,OAAO,CAACQ;MACb,CAAC;MAEDI,QAAQ,GAAG,MAAMC,KAAK,CAACH,OAAO,EAAE;QAC9B,GAAGV,OAAO;QACVQ,OAAO,EAAEe;MACX,CAAC,CAAC;IACJ,CAAC,MAAM;MACLrB,YAAY,CAACsB,UAAU,CAAC,QAAQ,CAAC;MACjCtB,YAAY,CAACsB,UAAU,CAAC,SAAS,CAAC;MAClCC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,QAAQ;IACjC;EACF;EAEA,OAAOf,QAAQ;AACjB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}