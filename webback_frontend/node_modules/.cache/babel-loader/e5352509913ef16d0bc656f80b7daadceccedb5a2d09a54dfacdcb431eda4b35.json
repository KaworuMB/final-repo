{"ast":null,"code":"const BASE_URL='http://127.0.0.1:8000';export const authFetch=async function(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const access=localStorage.getItem('access');const refresh=localStorage.getItem('refresh');const isFormData=options.body instanceof FormData;const headers={...(isFormData?{}:{'Content-Type':'application/json'}),Authorization:`Bearer ${access}`,...options.headers};const fullUrl=url.startsWith('http')?url:BASE_URL+url;let response=await fetch(fullUrl,{...options,headers});// Обновление access токена по refresh при 401\nif(response.status===401&&refresh){const refreshResponse=await fetch(BASE_URL+'/api/auth/refresh/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({refresh})});if(refreshResponse.ok){const data=await refreshResponse.json();localStorage.setItem('access',data.access);const retryHeaders={...(isFormData?{}:{'Content-Type':'application/json'}),Authorization:`Bearer ${data.access}`,...options.headers};response=await fetch(fullUrl,{...options,headers:retryHeaders});}else{localStorage.removeItem('access');localStorage.removeItem('refresh');window.location.href='/login';}}return response;};","map":{"version":3,"names":["BASE_URL","authFetch","url","options","arguments","length","undefined","access","localStorage","getItem","refresh","isFormData","body","FormData","headers","Authorization","fullUrl","startsWith","response","fetch","status","refreshResponse","method","JSON","stringify","ok","data","json","setItem","retryHeaders","removeItem","window","location","href"],"sources":["C:/Users/Moldabek Jora/PycharmProjects/Web_back_project/webback_frontend/src/utils/authFetch.js"],"sourcesContent":["const BASE_URL = 'http://127.0.0.1:8000';\r\n\r\nexport const authFetch = async (url, options = {}) => {\r\n  const access = localStorage.getItem('access');\r\n  const refresh = localStorage.getItem('refresh');\r\n\r\n  const isFormData = options.body instanceof FormData;\r\n\r\n  const headers = {\r\n    ...(isFormData ? {} : { 'Content-Type': 'application/json' }),\r\n    Authorization: `Bearer ${access}`,\r\n    ...options.headers,\r\n  };\r\n\r\n  const fullUrl = url.startsWith('http') ? url : BASE_URL + url;\r\n\r\n  let response = await fetch(fullUrl, {\r\n    ...options,\r\n    headers,\r\n  });\r\n\r\n  // Обновление access токена по refresh при 401\r\n  if (response.status === 401 && refresh) {\r\n    const refreshResponse = await fetch(BASE_URL + '/api/auth/refresh/', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ refresh }),\r\n    });\r\n\r\n    if (refreshResponse.ok) {\r\n      const data = await refreshResponse.json();\r\n      localStorage.setItem('access', data.access);\r\n\r\n      const retryHeaders = {\r\n        ...(isFormData ? {} : { 'Content-Type': 'application/json' }),\r\n        Authorization: `Bearer ${data.access}`,\r\n        ...options.headers,\r\n      };\r\n\r\n      response = await fetch(fullUrl, {\r\n        ...options,\r\n        headers: retryHeaders,\r\n      });\r\n    } else {\r\n      localStorage.removeItem('access');\r\n      localStorage.removeItem('refresh');\r\n      window.location.href = '/login';\r\n    }\r\n  }\r\n\r\n  return response;\r\n};\r\n\r\n"],"mappings":"AAAA,KAAM,CAAAA,QAAQ,CAAG,uBAAuB,CAExC,MAAO,MAAM,CAAAC,SAAS,CAAG,cAAAA,CAAOC,GAAG,CAAmB,IAAjB,CAAAC,OAAO,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,CAC/C,KAAM,CAAAG,MAAM,CAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAC7C,KAAM,CAAAC,OAAO,CAAGF,YAAY,CAACC,OAAO,CAAC,SAAS,CAAC,CAE/C,KAAM,CAAAE,UAAU,CAAGR,OAAO,CAACS,IAAI,WAAY,CAAAC,QAAQ,CAEnD,KAAM,CAAAC,OAAO,CAAG,CACd,IAAIH,UAAU,CAAG,CAAC,CAAC,CAAG,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAAC,CAC7DI,aAAa,CAAE,UAAUR,MAAM,EAAE,CACjC,GAAGJ,OAAO,CAACW,OACb,CAAC,CAED,KAAM,CAAAE,OAAO,CAAGd,GAAG,CAACe,UAAU,CAAC,MAAM,CAAC,CAAGf,GAAG,CAAGF,QAAQ,CAAGE,GAAG,CAE7D,GAAI,CAAAgB,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACH,OAAO,CAAE,CAClC,GAAGb,OAAO,CACVW,OACF,CAAC,CAAC,CAEF;AACA,GAAII,QAAQ,CAACE,MAAM,GAAK,GAAG,EAAIV,OAAO,CAAE,CACtC,KAAM,CAAAW,eAAe,CAAG,KAAM,CAAAF,KAAK,CAACnB,QAAQ,CAAG,oBAAoB,CAAE,CACnEsB,MAAM,CAAE,MAAM,CACdR,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CF,IAAI,CAAEW,IAAI,CAACC,SAAS,CAAC,CAAEd,OAAQ,CAAC,CAClC,CAAC,CAAC,CAEF,GAAIW,eAAe,CAACI,EAAE,CAAE,CACtB,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAL,eAAe,CAACM,IAAI,CAAC,CAAC,CACzCnB,YAAY,CAACoB,OAAO,CAAC,QAAQ,CAAEF,IAAI,CAACnB,MAAM,CAAC,CAE3C,KAAM,CAAAsB,YAAY,CAAG,CACnB,IAAIlB,UAAU,CAAG,CAAC,CAAC,CAAG,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAAC,CAC7DI,aAAa,CAAE,UAAUW,IAAI,CAACnB,MAAM,EAAE,CACtC,GAAGJ,OAAO,CAACW,OACb,CAAC,CAEDI,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAACH,OAAO,CAAE,CAC9B,GAAGb,OAAO,CACVW,OAAO,CAAEe,YACX,CAAC,CAAC,CACJ,CAAC,IAAM,CACLrB,YAAY,CAACsB,UAAU,CAAC,QAAQ,CAAC,CACjCtB,YAAY,CAACsB,UAAU,CAAC,SAAS,CAAC,CAClCC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAG,QAAQ,CACjC,CACF,CAEA,MAAO,CAAAf,QAAQ,CACjB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}